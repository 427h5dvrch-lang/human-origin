<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HumanOrigin</title>
    <style>
      :root{
        --bg:#f5f5f7; --card:#fff; --text:#1d1d1f; --muted:#86868b;
        --border:#d2d2d7; --accent:#0071e3; --danger:#ff3b30; --ok:#2e7d32; --warn:#e65100;
      }
      *{ box-sizing:border-box; }
      html,body{ margin:0; padding:0; width:100%; height:100%; font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif; background:var(--bg); color:var(--text); overflow:hidden; }
      header{
        background:var(--card); border-bottom:1px solid var(--border);
        padding:14px 18px; display:flex; justify-content:space-between; align-items:center; flex-shrink:0;
      }
      h1{ margin:0; font-size:16px; font-weight:700; }
      .muted{ color:var(--muted); font-size:12px; }
      .badge{ font-size:11px; padding:4px 8px; border-radius:999px; border:1px solid var(--border); }
      .badge.ok{ background:#e8f5e9; border-color:#c8e6c9; color:var(--ok); }
      .badge.warn{ background:#fff3e0; border-color:#ffe0b2; color:var(--warn); }

      main{
        height:calc(100vh - 54px);
        overflow:auto;
        padding:18px;
        max-width:1100px;
        margin:0 auto;
        display:flex;
        flex-direction:column;
        gap:14px;
      }
      .card{
        background:var(--card);
        border-radius:14px;
        padding:16px;
        box-shadow:0 2px 12px rgba(0,0,0,0.06);
        border:1px solid rgba(0,0,0,0.03);
      }
      .row{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
      input,select{
        padding:10px; border-radius:10px; border:1px solid var(--border);
        font-size:14px; min-width:220px;
      }
      button{
        padding:10px 14px; border-radius:10px; border:none;
        font-size:14px; font-weight:600; cursor:pointer;
        transition:transform .08s ease, opacity .15s ease;
      }
      button:active{ transform:scale(.98); }
      button[disabled]{ opacity:.5; cursor:not-allowed; }

      .btn-black{ background:#111; color:#fff; }
      .btn-blue{ background:var(--accent); color:#fff; }
      .btn-grey{ background:#e5e5ea; color:#111; }
      .btn-red{ background:var(--danger); color:#fff; }

      .hidden{ display:none !important; }

      /* Login */
      #login-screen{ height:calc(100vh - 54px); display:flex; justify-content:center; align-items:center; padding:18px; }
      #login-card{ width:360px; }
      #login-card h2{ margin:0 0 6px 0; font-size:18px; }
      #login-card p{ margin:0 0 12px 0; color:var(--muted); font-size:13px; line-height:1.35; }

      /* Draft banner */
      #draft-banner{
        background:#fff8e1; border:1px solid #ffe082; color:#f57f17;
        padding:10px 12px; border-radius:12px;
        display:none; align-items:center; justify-content:space-between; gap:10px;
      }

      /* Simple vs Expert */
      #mode-pill{
        display:flex; align-items:center; gap:8px;
      }
      #expert-toggle{ transform:scale(1.1); }

      /* Live dashboard */
      #live-dashboard{
        background:#0b0b0c; color:#fff; border-radius:14px; padding:18px;
        display:none;
      }
      #timer{ font-size:44px; font-weight:800; font-variant-numeric:tabular-nums; }
      #live-stats{ color:#cfcfcf; margin-top:6px; font-size:14px; }

      /* Tables */
      table{ width:100%; border-collapse:collapse; font-size:13px; }
      th{ text-align:left; color:var(--muted); border-bottom:1px solid var(--border); padding:8px 0; }
      td{ padding:10px 0; border-bottom:1px solid #eee; vertical-align:top; }
      tr:last-child td{ border-bottom:none; }
      .mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }

      /* Viewer modal */
      #viewer-modal{
        position:fixed; inset:0; background:rgba(0,0,0,0.45);
        display:none; justify-content:center; align-items:center; z-index:2000;
      }
      #viewer-box{
        width:min(980px, 92vw);
        height:min(720px, 86vh);
        background:#fff; border-radius:16px; overflow:hidden;
        box-shadow:0 12px 60px rgba(0,0,0,0.35);
        display:flex; flex-direction:column;
      }
      #viewer-top{
        padding:10px 12px; border-bottom:1px solid var(--border);
        display:flex; justify-content:space-between; align-items:center;
      }
      #viewer-title{ font-weight:700; font-size:14px; }
      #viewer-actions{ display:flex; gap:8px; align-items:center; }
      #viewer-frame{ flex:1; width:100%; border:0; }

      /* Toast */
      #toast{
        position:fixed; bottom:18px; right:18px;
        background:#111; color:#fff; padding:10px 14px;
        border-radius:12px; font-size:13px; display:none; z-index:3000;
      }
    </style>
  </head>

  <body>
    <header>
      <div class="row" style="gap:12px;">
        <h1>HumanOrigin</h1>
        <span class="badge" id="cloud-badge">CLOUD: ‚Ä¶</span>
      </div>

      <div class="row" style="justify-content:flex-end;">
        <div id="mode-pill" class="muted">
          <label class="row" style="gap:6px; margin:0;">
            <input id="expert-toggle" type="checkbox" />
            Mode expert
          </label>
        </div>
        <span class="muted" id="user-email-display">‚Äî</span>
        <button id="logout-btn" class="btn-grey" style="padding:7px 10px; font-size:12px;">Sortir</button>
      </div>
    </header>

    <!-- LOGIN -->
    <div id="login-screen">
      <div id="login-card" class="card">
        <h2>Connexion</h2>
        <p>Entrez votre email pour recevoir un lien de connexion.</p>
        <input id="email" type="email" placeholder="auteur@exemple.com" />
        <button id="login-btn" class="btn-black" style="width:100%; margin-top:10px;">Recevoir le lien de connexion</button>
        <div class="muted" style="margin-top:10px;">
          Astuce : le lien s‚Äôouvre et connecte automatiquement HumanOrigin.
        </div>
      </div>
    </div>

    <!-- APP -->
    <main id="app-screen" class="hidden">
      <div id="draft-banner" class="card">
        <div>‚ö†Ô∏è Une session interrompue a √©t√© trouv√©e.</div>
        <button id="btn-recover-draft" class="btn-black" style="padding:8px 10px; font-size:12px;">Restaurer</button>
      </div>

      <!-- Project selection -->
      <div class="card" id="project-section">
        <div class="row" style="justify-content:space-between; align-items:flex-end;">
          <div>
            <div class="muted">Projet</div>
            <div style="font-size:18px; font-weight:800;" id="current-project-title">Aucun projet</div>
          </div>
          <button id="refresh-projects-btn" class="btn-grey" style="padding:7px 10px; font-size:12px;">‚Üª Recharger la liste</button>
        </div>

        <div class="row" style="margin-top:12px;">
          <select id="project-selector"></select>
          <input id="project-name" type="text" placeholder="Ou cr√©er un projet‚Ä¶" />
          <button id="init-btn" class="btn-black">Charger / Cr√©er</button>
        </div>
      </div>

      <!-- Controls -->
      <div class="card hidden" id="controls-section">
        <div class="row" style="justify-content:space-between;">
          <div>
            <div style="font-size:16px; font-weight:800;">Session de travail</div>
            <div class="muted" id="session-hint">‚Äî</div>
          </div>
          <button id="sync-btn" class="btn-grey" style="padding:7px 10px; font-size:12px;">üîÑ Rafra√Æchir</button>
        </div>

        <div class="row" style="margin-top:10px;">
          <button id="start-btn" class="btn-black" style="flex:1;">‚ñ∂Ô∏é D√©marrer session</button>
          <button id="stop-btn" class="btn-red hidden" style="flex:1;">‚èπ Arr√™ter</button>
          <button id="finalize-btn" class="btn-blue" style="flex:1;" disabled>‚úÖ Certifier</button>
        </div>

        <div id="live-dashboard" style="margin-top:12px;">
          <div class="muted" style="text-transform:uppercase; letter-spacing:.08em;">Monitoring actif</div>
          <div id="timer">00:00</div>
          <div id="live-stats">Frappes: <span id="keystrokes-display">0</span> ‚Ä¢ Clics: <span id="clicks-display">0</span></div>
        </div>

        <!-- MODE SIMPLE: 2 boutons -->
        <div id="simple-actions" style="margin-top:12px;">
          <div class="row">
            <button id="open-last-session-cert-btn" class="btn-grey" style="flex:1;" disabled>Ouvrir le certificat de la derni√®re session</button>
            <button id="open-project-master-btn" class="btn-grey" style="flex:1;" disabled>Ouvrir le certificat final (projet)</button>
          </div>
          <div class="muted" style="margin-top:8px;">
            En mode simple, vous ne voyez que les preuves utiles. Le reste est disponible en mode expert.
          </div>
        </div>

        <!-- Export / Verify (EXPERT) -->
        <div id="expert-actions" class="hidden" style="margin-top:12px;">
          <div class="row">
            <button id="export-project-master-btn" class="btn-blue" style="flex:1;">Exporter le certificat final (HTML)</button>
            <button id="verify-project-btn" class="btn-grey" style="flex:1;">V√©rifier le projet (int√©grit√©)</button>
          </div>
          <div class="muted" style="margin-top:8px;">
            V√©rification V1 : recalcule les hashes depuis les JSON stock√©s, et v√©rifie la cha√Æne.
          </div>
        </div>
      </div>

      <!-- History -->
      <div class="card" id="history-card">
        <div class="row" style="justify-content:space-between;">
          <div style="font-size:16px; font-weight:800;">Historique & preuves</div>
          <span class="muted" id="history-subtitle">‚Äî</span>
        </div>

        <!-- MODE SIMPLE -->
        <div id="simple-history" style="margin-top:10px;">
          <table>
            <thead>
              <tr><th>Date</th><th>Preuve</th><th>Source</th></tr>
            </thead>
            <tbody id="simple-history-tbody"></tbody>
          </table>
        </div>

        <!-- MODE EXPERT -->
        <div id="expert-history" class="hidden" style="margin-top:10px;">
          <div class="muted" style="margin-bottom:6px;">Certificats (10 derniers)</div>
          <table>
            <thead>
              <tr><th>Date</th><th>Hash</th><th>Source</th><th>Type</th></tr>
            </thead>
            <tbody id="certs-tbody"></tbody>
          </table>

          <div class="muted" style="margin-top:16px; margin-bottom:6px;">Sessions (10 derni√®res)</div>
          <table>
            <thead>
              <tr><th>D√©but</th><th>Statut</th><th>Actions</th></tr>
            </thead>
            <tbody id="sessions-tbody"></tbody>
          </table>
        </div>
      </div>
    </main>

    <!-- Viewer modal -->
    <div id="viewer-modal">
      <div id="viewer-box">
        <div id="viewer-top">
          <div id="viewer-title">Certificat</div>
          <div id="viewer-actions">
            <button id="viewer-open-external-btn" class="btn-grey" style="padding:7px 10px; font-size:12px;">Ouvrir dans le navigateur</button>
            <button id="viewer-close-btn" class="btn-black" style="padding:7px 10px; font-size:12px;">Fermer</button>
          </div>
        </div>
        <iframe id="viewer-frame" title="Certificat"></iframe>
      </div>
    </div>

    <div id="toast"></div>

    <script type="module" src="/src/main.js"></script>
  </body>
</html>
